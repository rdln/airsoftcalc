"use strict";function EnergyCalculator(){var e=this;e.Energy=function(e,n){return.5*e*n*n},e.Speed=function(e,n){return Math.sqrt(n/e*2)},e.SpeedAtDistance=function(e,n,r,a){var t=8*e/(.47*r*Math.PI*.006*.006);return n*Math.pow(Math.E,-a/t)},e.EnergyAtDistance=function(n,r,a,t){var s=e.SpeedAtDistance(n,r,a,t);return e.Energy(n,s)}}function DistanceConversion(){var e=this;e.convertSpeedToFps=function(e){return 3.2808399*e},e.convertSpeedToMps=function(e){return.3048*e}}function ballModel(){var e=this;e.buildFromSpeedAndMass=function(e,n){return{speedMps:e,speedFps:(new DistanceConversion).convertSpeedToFps(e),mass:n,energy:(new EnergyCalculator).Energy(n/1e3,e),range:30,airDensity:1.2041,color:0}},e.buildFromEnergyAndMass=function(e,n){var r=(new EnergyCalculator).Speed(n/1e3,e);return{speedMps:r,speedFps:(new DistanceConversion).convertSpeedToFps(r),mass:n,energy:e,range:30,airDensity:1.2041,color:0}},e.speedMps=100,e.speedFps=(new DistanceConversion).convertSpeedToFps(100),e.mass=.2,e.energy=(new EnergyCalculator).Energy(2e-4,100),e.range=30,e.airDensity=1.2041,e.color=0}function ballViewModel(e,n){function r(){appViewModel.updatePlot(a)}var a=this,t=!0;a.index=n,a.speedMps=ko.observable(e.speedMps).extend({numeric:3}),a.speedMps.subscribe(function(e){if(!t){var n=e||1;t=!0,a.speedFps((new DistanceConversion).convertSpeedToFps(n)),a.energy((new EnergyCalculator).Energy(a.mass()/1e3,n)),t=!1,r()}}),a.speedFps=ko.observable(e.speedFps).extend({numeric:3}),a.speedFps.subscribe(function(e){if(!t){var n=e||1;t=!0,a.speedMps((new DistanceConversion).convertSpeedToMps(n)),a.energy((new EnergyCalculator).Energy(a.mass()/1e3,a.speedMps())),t=!1,r()}}),a.mass=ko.observable(e.mass).extend({numeric:3}),a.mass.subscribe(function(e){if(!t){var n=e||1;t=!0,a.speedMps((new EnergyCalculator).Speed(n/1e3,a.energy())),t=!1,r()}}),a.energy=ko.observable(e.energy).extend({numeric:3}),a.energy.subscribe(function(e){if(!t){var n=e||1;t=!0;var s=(new EnergyCalculator).Speed(a.mass()/1e3,n);a.speedMps(s),a.speedFps((new DistanceConversion).convertSpeedToFps(s)),t=!1,r()}}),a.range=ko.observable(e.range),a.range.subscribe(function(e){t||r()}),a.airDensity=ko.observable(e.airDensity),a.airDensity.subscribe(function(e){t||r()}),a.airTemp=[{temperature:30,density:1.1644},{temperature:20,density:1.2041},{temperature:10,density:1.2466},{temperature:0,density:1.2922},{temperature:-10,density:1.3413}],a.colorOptions=[{value:"#000",label:"black"},{value:"#00a",label:"blue"},{value:"#0a0",label:"green"},{value:"#0aa",label:"cyan"},{value:"#a00",label:"red"},{value:"#a0a",label:"magenta"},{value:"#a5a",label:"brown"},{value:"#aaa",label:"light gray"},{value:"#555",label:"dark gray"},{value:"#55f",label:"bright blue"},{value:"#5f5",label:"bright green"},{value:"#5ff",label:"bright cyan"},{value:"#f55",label:"bright red"},{value:"#f5f",label:"bright magenta"},{value:"#ff5",label:"bright yellow"}],a.color=ko.observable(a.colorOptions[e.color]),a.color.subscribe(function(e){t||r()}),a.speedAtDistance=function(){return(new EnergyCalculator).SpeedAtDistance(a.mass()/1e3,a.speedMps(),a.airDensity().density,a.range())},a.energyAtDistance=function(){return(new EnergyCalculator).EnergyAtDistance(a.mass()/1e3,a.speedMps(),a.airDensity().density,a.range())},a.colorRgb=function(){return a.color().value},t=!1}function viewModel(e,n){function r(e){var n=[{x:[],y:[]}];Plotly.plot(e,n,{margin:{t:0}})}function a(e,n,r,a,t,s,l,o){var i=[],u=[],c=0;for(c=0;c<a;c+=.1)i.push(c),u.push(r(c));var p={x:i,y:u,name:t,line:{color:s,width:l}};Plotly.addTraces(e,p,n)}var t=this;t.ballEntries=ko.observableArray(),t.addBallOnClick=function(){t.addBallPreset()},t.addBallPreset=function(e){var n=t.ballEntries(),r=0===n.length?new ballModel:ko.toJS(n[n.length-1]);if(null!=e&&(r.speedMps=e.speedMps,r.speedFps=e.speedFps,r.mass=e.mass,r.energy=e.energy,r.range=e.range),n.length>0){var a=r.color.value,s=n[n.length-1].colorOptions,l=0,o=0;for(o=0;o<s.length;o+=1)if(s[o].value===a){l=o;break}l+=1,l%=s.length,r.color=l}var i=new ballViewModel(r,t.ballEntries().length);t.addPlot(i),t.ballEntries.push(i)},t.removeBall=function(e){var n=e.index;t.removePlot(n);var r=0,a=t.ballEntries().length,s=t.ballEntries();for(r=n;r<a;r++)s[r].index--;t.ballEntries.remove(e)},t.setAllBallsSpeed=function(e){t.ballEntries().forEach(function(n,r){n.speedMps(e.speedMps()),n.speedFps(e.speedFps())})},t.setAllBallsMass=function(e){t.ballEntries().forEach(function(n,r){n.mass(e.mass())})},t.setAllBallsEnergy=function(e){t.ballEntries().forEach(function(n,r){n.energy(e.energy())})},t.setAllBallsRange=function(e){t.ballEntries().forEach(function(n,r){n.range(e.range())})},t.setAllBallsAirTemperature=function(e){t.ballEntries().forEach(function(n,r){n.airDensity(e.airDensity())})};var s=new EnergyCalculator;t.addPlot=function(e){var n=e.mass(),r=e.speedMps(),t=e.airDensity().density,l=e.color().value;a(speedPlot,e.index,function(e){return s.SpeedAtDistance(n/1e3,r,t,e)},100,"Speed "+n+"g, "+r+"m/s",l,1),a(energyPlot,e.index,function(e){return s.EnergyAtDistance(n/1e3,r,t,e)},100,"Energy "+n+"g, "+r+"m/s",l,3)},t.removePlot=function(e){e>=0&&(Plotly.deleteTraces(speedPlot,e),Plotly.deleteTraces(energyPlot,e))},t.updatePlot=function(e){null!=e&&(t.removePlot(e.index),t.addPlot(e))},r(speedPlot),r(energyPlot)}ko.extenders.numeric=function(e,n){var r=ko.pureComputed({read:e,write:function(r){var a=e(),t=Math.pow(10,n),s=isNaN(r)?0:+r,l=Math.round(s*t)/t;l!==a?e(l):r!==a&&e.notifySubscribers(l)}}).extend({notify:"always"});return r(e()),r};